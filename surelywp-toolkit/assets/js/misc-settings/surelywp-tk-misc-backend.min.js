"use strict";jQuery(document).ready(function(e){function t(){let t=i(window.location.href,"id");t&&e.ajax({url:tk_misc_backend_ajax_object.ajax_url,type:"POST",data:{action:"surelywp_tk_misc_get_product_downloads",product_id:t,view_type:"admin",nonce:tk_misc_backend_ajax_object.misc_ajax_nonce},dataType:"json",success:function(t){if(!t.status)return;let n=t.downloads.filter(e=>e?.media?.content_type?.startsWith("image/")).map(e=>({id:e.media.id,filename:e.media.filename}));n.forEach(t=>{let n=document.querySelectorAll(".css-djnk3q");n.forEach(n=>{let r=n.parentElement?.querySelector(".css-1uabedp");r&&r.textContent.trim()===t.filename&&!n.querySelector("img")&&(n.innerHTML='<sc-skeleton style="width: 100%; height: 100%; --border-radius: 0;"></sc-skeleton>',e.ajax({url:tk_misc_backend_ajax_object.ajax_url,type:"POST",data:{action:"surelywp_tk_misc_get_download_media_url",media_id:t.id,view_type:"admin",nonce:tk_misc_backend_ajax_object.misc_ajax_nonce},dataType:"json",success:function(e){let n=e?.url;if(!n)return;let r=document.querySelectorAll(".css-djnk3q");r.forEach(e=>{let r=e.parentElement?.querySelector(".css-1uabedp");if(r&&r.textContent.trim()===t.filename){let s=document.createElement("img");s.src=n,s.alt=t.filename,s.style.maxWidth="100%",s.style.height="auto",e.innerHTML="",e.appendChild(s)}})},error:function(e,n,r){console.error(`Error loading media for ID ${t.id}:`,r)}}))})})},error:function(e,t,n){console.error("Error fetching downloads:",n)}})}if(e(document).on("scChange",".sc-show-archived",function(e){e.target.checked&&t()}),e(document).on("click",".css-2okr1n",function(e){setTimeout(()=>{t()},1e3)}),e(".surecart_page_sc-products").length&&setTimeout(()=>{t()},1e3),e(document).on("click","#sc-checkout-sync-btn",function(t){e(".msg-success").remove(),!e(this).hasClass("sysc-loading")&&(e(this).addClass("sysc-loading"),e.ajax({url:tk_misc_backend_ajax_object.ajax_url,type:"POST",dataType:"json",data:{action:"surelywp_tk_misc_manual_checkout_sync",nonce:tk_misc_backend_ajax_object.misc_ajax_nonce},success:function(t){e("#sc-checkout-sync-btn").removeClass("sysc-loading"),t.status&&e("#sc-checkout-sync-btn").after('<p class="msg-success">'+t.message+"</p>")}}))}),e(".surecart_page_sc-orders .css-htf0c5").length&&tk_misc_backend_ajax_object.order_id&&tk_misc_backend_ajax_object.enable_retry_btn)var n=setInterval(function(){var t=jQuery(".css-htf0c5").eq(0).find("sc-order-status-badge").attr("status");if(t){if("payment_failed"===t){var r=tk_misc_backend_ajax_object.order_id;e.ajax({url:tk_misc_backend_ajax_object.ajax_url,type:"POST",dataType:"json",data:{action:"surelywp_tk_misc_get_payment_retry_button_tag",nonce:tk_misc_backend_ajax_object.misc_ajax_nonce,order_id:r},success:function(t){t.status&&(e(".css-t9ogfm sc-dropdown sc-menu").append(t.retry_button),e("body").append(t.dialog_popup))}})}clearInterval(n)}},1e3);if(e(document).on("click","#surelywp-retry-payment-menu",function(t){e("#surelywp-retry-payment-confirm-popup").attr("open",!0)}),e(document).on("click","#surelywp-retry-payment-cancel",function(t){e("#surelywp-retry-payment-confirm-popup").attr("open",!1)}),e(document).on("click","#surelywp-retry-payment-btn",function(t){var n=e(this).data("period-id");e(this).attr("loading",!0),e.ajax({url:tk_misc_backend_ajax_object.ajax_url,type:"POST",dataType:"json",data:{action:"surelywp_tk_misc_retry_sub_payment",nonce:tk_misc_backend_ajax_object.misc_ajax_nonce,period_id:n},success:function(t){t&&(e("body").append('<div class="components-snackbar-list css-uksis0" tabindex="-1" data-testid="snackbar-list"><div style="height: auto; opacity: 1;"><div class="components-snackbar-list__notice-container"><div class="components-snackbar" tabindex="0" role="button" aria-label="Dismiss this notice" data-testid="snackbar"><div class="components-snackbar__content">'+t.message+"</div></div></div></div></div>"),e("#surelywp-retry-payment-confirm-popup").attr("open",!1),setTimeout(function(){window.location.reload()},1e3))}})}),setTimeout(()=>{if(e(".surecart_page_sc-orders .css-htf0c5").length&&tk_misc_backend_ajax_object.enable_recovered_badge)var t=setInterval(function(){var n=e(".css-wzxb7d > div:first-child").find("sc-line-item a").attr("href"),r=i(n,"id");if(r){window.location.href;var s=new URLSearchParams(window.location.search).get("id");s&&e.ajax({url:tk_misc_backend_ajax_object.ajax_url,type:"POST",dataType:"json",data:{action:"surelywp_tk_misc_add_recovered_tag",customer_id:r,order_id:s},success:function(t){t.status&&e(".css-dainmi .css-htf0c5").append(t.tag)}}),clearInterval(t)}},1e3)},1500),e(document).on("change","#surelywp-tk-misc-enable-rename-name",function(t){e("#customer-dashboard-nav-menu-title").toggle()}),e(document).on("change","#surelywp-tk-misc-enable-login-redirection",function(t){e("#surelywp-tk-misc-login-redirect-url").toggle()}),e(document).on("change","#surelywp-tk-misc-enable-role-based-login-redirection",function(t){e("#role-based-redirection-option").toggle(),e("#surelywp-tk-misc-login-redirection-user-roles").select2()}),e(document).on("select2:select","#surelywp-tk-misc-login-redirection-user-roles",function(t){var n=t.params.data.id,r=t.params.data.text,s=e("#surelywp-tk-misc-login-redirect-url").clone();s.removeClass("hidden"),s.attr("id",n+"-login-redirection"),s.find(".input-label").text(r+" Login Redirection URL"),s.find(".input-label-desc").text("Enter the URL where users with the "+r+" user role should be redirected when logging into the SureCart Customer Dashboard.");var a=s.find("input");a.attr("id",""),a.attr("name","surelywp_tk_misc_settings_options[redirection_urls]["+n+"][login_redirect_url]"),a.val(""),e(".role-based-redirection-option").append(s)}),e(document).on("select2:unselect","#surelywp-tk-misc-login-redirection-user-roles",function(t){e("#"+t.params.data.id+"-login-redirection").remove()}),e(document).on("change","#surelywp-tk-misc-enable-logout-redirection",function(t){e("#surelywp-tk-misc-logout-redirect-url").toggle()}),e(document).on("change","#surelywp-tk-misc-enable-bh-redirection",function(t){e("#surelywp-tk-misc-bh-redirect-url").toggle()}),e(".surelywp-price-desc-display-type").length&&(document.querySelector(".surelywp-price-desc-display-type").choices=[{label:"Display Only Selected Price Description",value:"display_selected"},{label:"Display All Descriptions",value:"display_all"}]),e("#surelywp_tk_misc_price_desc").length){var r=e("#surelywp_tk_misc_price_desc");let s=setInterval(function(){e(".css-1pdnxkc").length&&!e(".css-1pdnxkc").next().is(r)&&(e(".css-1pdnxkc").after(r),r.removeClass("hidden"),clearInterval(s))},500)}if(e("#surelywp_tk_misc_external_product").length){var a=e("#surelywp_tk_misc_external_product");a.removeClass("hidden"),a.remove(),e(".css-wzxb7d > div").eq(0).after(a)}function i(e,t){if(e){for(var n=e.substring(e.indexOf("?")+1).split("&"),r=0;r<n.length;r++)if(n[r]=n[r].split("="),n[r][0]===t)return decodeURIComponent(n[r][1])}return!1}(e("#surelywp_tk_misc_price_desc").length||e("#surelywp_tk_misc_external_product").length)&&e(document).on("scFormSubmit",".sc-model-form",function(t){var n=new FormData,r=e(".surelywp-tk-product-post-id").val();n.append("post_id",r);var s=e("#surelywp_tk-external-product-open-new-tab").prop("checked")?1:0,a=e("#surelywp-tk-external-product-btn-url").val(),i=e("#surelywp-tk-external-product-btn-text").val();n.append("is_external_product_link_open_new_tab",s),n.append("external_product_btn_url",a),n.append("external_product_btn_text",i);var c=e("#surelywp-price-desc-display-type").val();n.append("_surelywp_tk_misc_price_desc_display_type",c),e(".surelyp-tk-misc-price-desc-input").each(function(){var t=e(this).attr("name"),r=e(this).val();n.append(t,r)}),n.append("action","surelywp_tk_misc_update_product_meta"),n.append("nonce",tk_misc_backend_ajax_object.misc_ajax_nonce),console.log(n),e.ajax({url:tk_misc_backend_ajax_object.ajax_url,type:"POST",dataType:"json",data:n,processData:!1,contentType:!1})})});