"use strict";jQuery(document).ready(function(e){if(e(".surelywp-lead-magnet-button").length||e("#surelywp-tk-lm-form").length){function t(t,r,o,l){e(t).after("<sc-alert class='lm-alert-msg surelywp-lm-error' open type='"+o+"'>"+r+"</sc-alert>"),l&&setTimeout(function(){e(".lm-alert-msg").remove()},l)}tk_lm_front_ajax_object.is_user_login&&tk_lm_front_ajax_object.consent_checkbox&&e(".surelywp-lead-magnet-button").before(tk_lm_front_ajax_object.consent_checkbox),e(document).on("click",".surelywp-lead-magnet-button",function(r){if(!e(this).hasClass("disable")){r.preventDefault(),e(".lm-alert-msg").remove();var o,l=tk_lm_front_ajax_object.is_user_login,a=!1;if(l&&e(".optin_form_consent_checkbox").length){var n=e(".optin_form_consent_checkbox");if(a=!!n.prop("checked"),n.prop("required")&&!a){t(".surelywp-lead-magnet-button",wp.i18n.__("Please check the consent checkbox.","surelywp-toolkit"),"danger",36e5);return}}var s=e(this).attr("class").match(/lm-product-id-([a-z0-9\-]+)/);if(s)o=s[1];else if(e("#sc-store-data").length){var i=JSON.parse(e("#sc-store-data").html());i.product&&(o=Object.keys(i.product)[0])}else e(".wp-block-surecart-product-page").length&&(o=JSON.parse(e(".wp-block-surecart-product-page").attr("data-wp-context")).product.id);if(!o){t(".surelywp-lead-magnet-button",wp.i18n.__("Product ID not found.","surelywp-toolkit"),"danger",36e5);return}if(l){var u="surlywp-lm-optin-btn"===e(this).find("sc-button").attr("id"),m=e(this).find(".wp-element-button"),c=m.html();u?(e("#surlywp-lm-optin-btn").attr("loading","true"),e("#surlywp-lm-optin-btn").attr("disabled","true")):(e(".surelywp-lead-magnet-button").addClass("disable"),m.html('<span style="visibility: hidden;">'+c+'</span><sc-spinner class="lm-btn-loader"></sc-spinner>')),e(".lm-alert-msg").length>0&&e(".lm-alert-msg").remove(),e.ajax({url:tk_lm_front_ajax_object.ajax_url,dataType:"json",type:"POST",data:{action:"surelywp_tk_lm_login_user_handler",product_id:o,is_customer_give_consent:a,nonce:tk_lm_front_ajax_object.nonce},success:function(r){if(u?(e("#surlywp-lm-optin-btn").attr("loading","false"),e("#surlywp-lm-optin-btn").removeAttr("disabled")):(e(".surelywp-lead-magnet-button").removeClass("disable"),m.html(c)),!0==r.status){e(".surelywp-lm-optin-form-modal").remove(),r.already_created||t(".surelywp-lead-magnet-button",wp.i18n.__("Order Created successfully.","surelywp-toolkit"),"success",36e5);var o=r.dashboard_url.toString();window.location.href=o}else""!==r.error?t(".surelywp-lead-magnet-button",r.error,"danger",36e5):t(".surelywp-lead-magnet-button",wp.i18n.__("Something went wrong","surelywp-toolkit"),"danger",36e5)}}).catch(e=>{console.error("Error:",e)})}else e("body").append('<div class="lm-loader-wrap"><span class="lm-loader"></span></div>'),e.ajax({url:tk_lm_front_ajax_object.ajax_url,type:"POST",dataType:"json",data:{action:"surelywp_tk_lm_modal_render",product_id:o,nonce:tk_lm_front_ajax_object.nonce},success:function(r){(e(".lm-loader-wrap").remove(),r.status)?e("body").append(r.form_html):r.error&&t(".surelywp-lead-magnet-button",r.error,"danger",36e5)}}).catch(e=>{console.error("Error:",e)})}}),e(document).on("scFormSubmit","#surelywp-tk-lm-form",function(r){r.preventDefault(),e("#optin-submit-btn").attr("loading","true"),e("#optin-submit-btn").attr("disabled","true"),e(".lm-alert-msg").length>0&&e(".lm-alert-msg").remove();var o=e("#optin_form_submit_nonce").val(),l=e("#surelywp-lm-product-id").val(),a=r.target.getFormJson(),n=[];a.then(r=>{n=r,e.ajax({url:tk_lm_front_ajax_object.ajax_url,type:"POST",dataType:"json",data:{action:"surelywp_tk_lm_optin_form_submit_callback",form_data:n,nonce:o,product_id:l},success:function(r){e("#optin-submit-btn").attr("loading","false"),e("#optin-submit-btn").removeAttr("disabled");var o="";if(o=e(".surelywp-lead-magnet-button").length?".surelywp-lead-magnet-button":".surelywp-subscription-form",!0==r.email_status)e(".surelywp-lm-optin-form-modal").remove(),t(o,r.email_verification_message,"success",null),e(".surelywp-subscription-form").remove();else if(!0==r.status){e(".surelywp-lm-optin-form-modal").remove(),r.already_created||(t(o,wp.i18n.__("Order Created successfully.","surelywp-toolkit"),"success",2e4),e(".surelywp-subscription-form").remove());var l=r.dashboard_url.toString();window.location.href=l}else""!=r.error?t(".optin-submit-btn",r.error,"danger",null):t(".optin-submit-btn",wp.i18n.__("Something went wrong","surelywp-toolkit"),"danger",5e4)}})}).catch(e=>{console.error("Error:",e)})}),e(document).on("click","#email-optin-form-modal-close",function(){e(".surelywp-lm-optin-form-modal").remove()})}});